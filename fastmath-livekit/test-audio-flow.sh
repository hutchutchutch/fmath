#!/bin/bash

echo "ğŸ¤ Testing Audio Flow"
echo "===================="
echo ""
echo "This script will help debug the audio flow from browser to backend."
echo ""
echo "1. Start the backend and watch for these logs:"
echo ""
echo "INITIAL CONNECTION:"
echo "  âœ… Groq service initialized"
echo "  ğŸ”Œ New audio stream WebSocket connection"
echo "  ğŸ“¡ Audio stream connected for room: default, participant: user"
echo "  ğŸ”„ Connecting to Deepgram..."
echo "  âœ… Connected to Deepgram WebSocket"
echo ""
echo "AUDIO FLOW (when speaking):"
echo "  ğŸ“¤ PCM16 chunk #1 received for Deepgram, size: XXXX bytes"
echo "  ğŸµ Handling PCM16 audio data for Deepgram"
echo "  ğŸ“Š Deepgram: Sent XX KB total"
echo "  ğŸ“¨ Deepgram message: { type: 'Results', hasTranscript: true, transcript: 'five' }"
echo ""
echo "  ğŸ“¹ WebM chunk #1 received for Groq, size: XXXX bytes"
echo "  ğŸ“¹ WebM audio data received for Groq"
echo "  ğŸ¯ Processing WebM chunk #1 with Groq"
echo "  âœ… Groq transcription completed in XXXms"
echo ""
echo "TRANSCRIPTION OUTPUT:"
echo "  ğŸ“ DEEPGRAM transcription: { originalText: 'five', sanitizedText: 'five', number: 5 }"
echo "  ğŸ“ GROQ transcription: { originalText: 'five', sanitizedText: 'five', number: 5 }"
echo "  ğŸš€ Emitting transcription event"
echo ""
echo "2. In the browser console, you should see:"
echo "  ğŸ¬ Starting MediaRecorder recording..."
echo "  ğŸ›‘ Stopping MediaRecorder recording..."
echo "  ğŸ“¦ MediaRecorder stopped, chunks collected: X"
echo "  ğŸµ WebM blob size: XXXXX bytes"
echo "  ğŸ“¤ Sending WebM data to backend: XXXXX bytes"
echo ""
echo "3. Common issues:"
echo "  - No PCM16 chunks = ScriptProcessor not working"
echo "  - No WebM chunks = MediaRecorder not working"
echo "  - No Deepgram messages = Deepgram WebSocket issue"
echo "  - No Groq results = Groq API or format issue"
echo ""
echo "Press Ctrl+C to exit"